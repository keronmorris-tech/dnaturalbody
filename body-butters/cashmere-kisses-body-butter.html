<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Cashmere Kisses | D'NATURAL BODY</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../styles.css">

  <style>
    /* Hide Shopify Buy Button built-in UI inside this component (we render our own) */
    #product-component-1771275419576 .shopify-buy__product__variant-selectors,
    #product-component-1771275419576 .shopify-buy__option-select-wrapper,
    #product-component-1771275419576 select.shopify-buy__option-select__select,
    #product-component-1771275419576 .shopify-buy__product__price,
    #product-component-1771275419576 .shopify-buy__product__actual-price,
    #product-component-1771275419576 .shopify-buy__product__compare-price,
    #product-component-1771275419576 .shopify-buy__btn {
      display: none !important;
    }

    /* Custom buy box */
    .dn-buybox {
      margin-top: 18px;
      border-top: 1px solid rgba(0,0,0,0.08);
      padding-top: 16px;
    }

    .dn-label {
      font-family: 'Montserrat', sans-serif;
      font-size: 13px;
      color: rgba(0,0,0,0.65);
      margin: 10px 0 8px 0;
    }

    .dn-sizes {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }

    .dn-chip {
      font-family: 'Montserrat', sans-serif;
      font-size: 14px;
      padding: 10px 18px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.25);
      background: #fff;
      color: #0b0a0a;
      cursor: pointer;
      user-select: none;
      transition: transform 0.05s ease, background 0.2s ease;
    }
    .dn-chip:active { transform: scale(0.98); }
    .dn-chip[aria-pressed="true"]{
      background: #0b0a0a;
      color: #fff;
      border-color: #0b0a0a;
      font-weight: 700;
    }

    .dn-qtywrap {
      display: inline-flex;
      align-items: center;
      border: 1px solid rgba(0,0,0,0.25);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 14px;
      background: #fff;
    }
    .dn-qtybtn {
      width: 44px;
      height: 42px;
      border: 0;
      background: transparent;
      font-size: 18px;
      cursor: pointer;
      color: #0b0a0a;
    }
    .dn-qtynum {
      width: 54px;
      height: 42px;
      display: grid;
      place-items: center;
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      color: #0b0a0a;
      border-left: 1px solid rgba(0,0,0,0.15);
      border-right: 1px solid rgba(0,0,0,0.15);
    }

    .dn-actions {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .dn-add {
      background: #1d201c;
      color: #fff;
      border: none;
      padding: 14px 18px;
      border-radius: 10px;
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      cursor: pointer;
      min-width: 170px;
    }
    .dn-add:hover { background: #313630; }
    .dn-add:disabled { opacity: 0.6; cursor: not-allowed; }

    .dn-note {
      font-family: 'Montserrat', sans-serif;
      font-size: 13px;
      color: rgba(0,0,0,0.65);
      margin-top: 8px;
    }
  </style>
</head>

<body class="product-body">
  <header class="header">
    <a href="../index.html" class="logo">
      <img src="../images/logo.png" alt="D'NATURAL BODY Logo">
    </a>

    <nav class="main-nav">
      <a href="../index.html" class="nav-link">Home</a>

      <div class="nav-item dropdown">
        <a href="../shop.html" class="nav-link">Shop â–¾</a>
        <div class="dropdown-menu">
          <a href="../shop.html">View All</a>
          <a href="../shop-body-butter.html">Body Butter</a>
          <a href="../shop-body-scrub.html">Body Scrub</a>
          <a href="../shop-body-yogurt.html">Body Yogurt</a>
        </div>
      </div>

      <a href="../about.html" class="nav-link">About</a>
      <a href="../contact.html" class="nav-link">Contact</a>

      <button class="cart-button" id="cartButton" type="button" aria-label="Cart">
        <span class="cart-icon">ðŸ‘œ</span>
        <span class="cart-count" id="cartCount" style="display:none;">0</span>
      </button>
    </nav>
  </header>

  <section class="product-detail">
    <div class="product-detail-inner">

      <div class="product-image">
        <img src="../images/Cashmere-kisses-body-butter.jpg" alt="Cashmere Kisses">
      </div>

      <div class="product-info">
        <h1>Cashmere Kisses</h1>
        <div class="product-type">Body Butter</div>

        <!-- price updates when size changes -->
        <div class="price" id="dnPriceTop">$â€”</div>

        <p class="product-desc">
          A soft, cozy blend that feels like your favorite cashmere sweater on the skin â€” smoothing,
          comforting, and perfect for everyday luxury.
        </p>

        <!-- DETAILS FIRST -->
        <div class="product-sections">
          <details open>
            <summary>Benefits</summary>
            <p>
              â€¢ Cushions dry skin with rich, creamy moisture.<br>
              â€¢ Adds a soft, comforting scent that hugs the skin.<br>
              â€¢ Helps improve the look and feel of rough areas over time.
            </p>
          </details>

          <details>
            <summary>Ingredients</summary>
            <p>
              59.5% Distilled Water, Glycerin, Jojoba Oil, Shea Butter, Mango Butter, Cocoa Butter,
              Cetyl Alcohol, BTMS-50, Liquid Germall Plus, Fragrance/Essential Oil.
            </p>
          </details>

          <details>
            <summary>How to Use</summary>
            <p>Apply from neck to toes after bathing, or anytime you want that soft-cashmere feel.</p>
          </details>
        </div>

        <!-- BUY AREA -->
        <div class="dn-buybox">
          <div class="dn-label">Size</div>
          <div class="dn-sizes" id="dnSizes"></div>

          <div class="dn-label">Quantity</div>
          <div class="dn-qtywrap" aria-label="Quantity selector">
            <button class="dn-qtybtn" id="dnMinus" type="button" aria-label="Decrease quantity">âˆ’</button>
            <div class="dn-qtynum" id="dnQty">1</div>
            <button class="dn-qtybtn" id="dnPlus" type="button" aria-label="Increase quantity">+</button>
          </div>

          <div class="dn-actions">
            <button class="dn-add" id="dnAdd" type="button" disabled>Add to cart</button>
            <a href="../shop-body-butter.html" class="outline-btn">Back</a>
          </div>

          <div class="dn-note" id="dnNote">Loading sizesâ€¦</div>

          <!-- Hidden mount (optional, keeps Buy Button UI consistent, but we don't depend on it for pricing) -->
          <div id="product-component-1771275419576" style="display:none;"></div>
        </div>
      </div>

    </div>
  </section>

  <footer class="footer">
    <p>Â© 2026 D'NATURAL BODY</p>
    <p>Email: dnaturalbody@outlook.com</p>
  </footer>

  <div id="shopify-cart-toggle" style="display:none;"></div>
  <script src="../buybutton.js"></script>

  <script>
    (function () {
      // âœ… CASHMERE KISSES Product ID (numeric)
      var PRODUCT_ID = '14889665036653';

      // âœ… MUST match your buybutton.js config
      var SHOP_DOMAIN = 'dpscr1-vz.myshopify.com';
      var STOREFRONT_TOKEN = 'b6634d4da21c44f64244a1ff19a52d78';
      // pick a stable API version
      var STOREFRONT_API = 'https://' + SHOP_DOMAIN + '/api/2024-07/graphql.json';

      var selectedVariantGid = null;
      var selectedVariantTitle = '';
      var selectedVariantPrice = null;
      var selectedCurrency = 'CAD';
      var qty = 1;

      var priceTopEl = document.getElementById('dnPriceTop');
      var sizesEl = document.getElementById('dnSizes');
      var addBtn = document.getElementById('dnAdd');
      var noteEl = document.getElementById('dnNote');
      var qtyEl = document.getElementById('dnQty');
      var minusBtn = document.getElementById('dnMinus');
      var plusBtn = document.getElementById('dnPlus');

      function formatMoney(amountStr, currencyCode) {
        var n = Number(amountStr);
        var c = currencyCode || 'CAD';
        if (!Number.isFinite(n)) return '$â€”';
        try {
          return new Intl.NumberFormat('en-CA', { style: 'currency', currency: c }).format(n);
        } catch (e) {
          return '$' + n.toFixed(2) + ' ' + c;
        }
      }

      function setQty(newQty) {
        qty = Math.max(1, newQty);
        qtyEl.textContent = String(qty);
      }
      minusBtn.addEventListener('click', function () { setQty(qty - 1); });
      plusBtn.addEventListener('click', function () { setQty(qty + 1); });

      function clearPressed() {
        Array.prototype.forEach.call(sizesEl.querySelectorAll('.dn-chip'), function (b) {
          b.setAttribute('aria-pressed', 'false');
        });
      }

      function renderSizes(variants) {
        sizesEl.innerHTML = '';

        variants.forEach(function (v, idx) {
          var title = (v.title || '').trim();
          var btn = document.createElement('button');
          btn.type = 'button';
          btn.className = 'dn-chip';
          btn.textContent = title;
          btn.setAttribute('aria-pressed', 'false');

          btn.addEventListener('click', function () {
            clearPressed();
            btn.setAttribute('aria-pressed', 'true');

            selectedVariantGid = v.id;
            selectedVariantTitle = title;
            selectedVariantPrice = v.price.amount;
            selectedCurrency = v.price.currencyCode || selectedCurrency;

            priceTopEl.textContent = formatMoney(selectedVariantPrice, selectedCurrency);
            addBtn.disabled = false;
            noteEl.textContent = 'Selected: ' + selectedVariantTitle;
          });

          sizesEl.appendChild(btn);

          // auto-select first
          if (idx === 0) setTimeout(function () { btn.click(); }, 0);
        });

        if (!variants.length) {
          noteEl.textContent = 'No sizes found.';
        }
      }

      function addToCart() {
        if (!selectedVariantGid) return;

        // Wait for DNShopify cart to exist (buybutton.js loads async)
        if (!window.DNShopify || !window.DNShopify.cart || typeof window.DNShopify.cart.addLineItems !== 'function') {
          noteEl.textContent = 'Cart is still loadingâ€¦ try again in a second.';
          return;
        }

        addBtn.disabled = true;
        addBtn.textContent = 'Addingâ€¦';

        window.DNShopify.cart.addLineItems([
          { variantId: selectedVariantGid, quantity: qty }
        ]).then(function () {
          addBtn.textContent = 'Add to cart';
          addBtn.disabled = false;
          if (window.DNShopify.openCart) window.DNShopify.openCart();
        }).catch(function () {
          addBtn.textContent = 'Add to cart';
          addBtn.disabled = false;
          noteEl.textContent = 'Could not add item. Please try again.';
        });
      }
      addBtn.addEventListener('click', addToCart);

      // âœ… Reliable variant fetch via Storefront GraphQL
      function fetchVariants() {
        noteEl.textContent = 'Loading sizesâ€¦';

        var gid = 'gid://shopify/Product/' + PRODUCT_ID;

        var query = `
          query ProductVariants($id: ID!) {
            product(id: $id) {
              variants(first: 50) {
                edges {
                  node {
                    id
                    title
                    availableForSale
                    priceV2 { amount currencyCode }
                  }
                }
              }
            }
          }
        `;

        return fetch(STOREFRONT_API, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-Shopify-Storefront-Access-Token': STOREFRONT_TOKEN
          },
          body: JSON.stringify({ query: query, variables: { id: gid } })
        })
        .then(function (res) { return res.json(); })
        .then(function (json) {
          var edges = json && json.data && json.data.product
            && json.data.product.variants && json.data.product.variants.edges
            ? json.data.product.variants.edges
            : [];

          var variants = edges.map(function (e) {
            return {
              id: e.node.id,
              title: e.node.title,
              available: e.node.availableForSale,
              price: e.node.priceV2
            };
          });

          // (Optional) filter out unavailable variants:
          // variants = variants.filter(v => v.available);

          renderSizes(variants);
          noteEl.textContent = 'Select a size.';
        })
        .catch(function () {
          noteEl.textContent = 'Could not load pricing. Please refresh.';
        });
      }

      // Optional: mount hidden Buy Button product (not required for chips/prices)
      function mountHiddenProduct() {
        if (!window.DNShopify || !window.DNShopify.mountProduct) return;
        window.DNShopify.mountProduct({
          id: PRODUCT_ID,
          node: '#product-component-1771275419576',
          options: { cart: { popup: false } }
        });
      }

      setQty(1);
      fetchVariants();

      // Try to mount hidden product once buybutton.js is ready (optional)
      (function waitForDN(){
        if (!window.DNShopify || !window.DNShopify.mountProduct) return setTimeout(waitForDN, 80);
        mountHiddenProduct();
      })();
    })();
  </script>

</body>
</html>
